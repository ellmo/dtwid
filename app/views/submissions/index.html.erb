<h1>Listing submissions</h1>

<div style="margin-top">
  <%= form_tag search_submissions_path, :method => :post do %>
    <%= text_field "search", "s", :value => params[:s] %>
    <%= hidden_field "search", "c", :value => params[:c] %>
    <%= hidden_field "search", "c2", :value => params[:c2] %>
    <%= hidden_field "search", "d", :value => params[:d] %>
    <br />
    <%= radio_button "search", "e", "",
      {:checked => (params[:e].nil? ? "checked" : "") } %>All
    <%= radio_button "search", "e", "1",
      {:checked => (params[:e]=="1" ? "checked" : "") } %>KDITD
    <%= radio_button "search", "e", "2",
      {:checked => (params[:e]=="2" ? "checked" : "") } %>TSOH
    <%= radio_button "search", "e", "3",
      {:checked => (params[:e]=="3" ? "checked" : "") } %>Inferno
    <%= radio_button "search", "e", "4",
      {:checked => (params[:e]=="4" ? "checked" : "") } %>TFC
    <%= button_to "search", "submit_search", :class => "asd" %>
    
  <% end %>
</div>

<%= link_to 'New Submission', new_submission_path %>

<table style="margin-top:20px; margin-bottom:30px;">
  <tr>
    <th></th>
    <th><%= sort_link 'Name', :name %></th>
    <th><%= sort_link 'Playing MapSlot', :map_episode_id, :map_slot_id %></th>
    <th><%= sort_link 'Intended MapSlot', :intended_map_episode_id, :intended_map_slot_id %></th>
    <th><%= sort_link 'Author', "map_authors.nick", "submissions.created_at" %></th>
    <th><%= sort_link 'Last Link Update', "submissions.link_updated_at" %></th>
    <th><%= sort_link 'Last Update', "submissions.updated_at" %></th>
    <th><%= sort_link 'Images', :image_count %></th>
    <th>Link</th>
    <th></th>
    <th></th>
  </tr>

<% @submissions.each_with_index do |submission, index| %>
  <%= content_tag :tr,
      :class => (((index%2 == 1) ? 'odd_row ' : 'even_row ') + submission.get_css_row_style ) do %>
    <td><%= index+1 %></td>
    <td><%= link_to submission.name, submission, {:class => submission.get_css_row_style } %></td>
    <td><%= "E#{submission.map_episode.id}#{submission.map_slot.name}" %></td>
    <td><%= "E#{submission.intended_map_episode.id}#{submission.intended_map_slot.name}" %></td>
    <td><%= submission.map_author.nick %></td>
    <td>
      <div style="margin:0px; width:90px; text-align:center;">
        <%= submission.link_updated_at.strftime("%d-%b-%Y\n(%H:%M)") %>
      </div>
    </td>
    <td>
      <div style="margin:0px; width:90px; text-align:center;">
        <%= submission.updated_at.strftime("%d-%b-%Y\n(%H:%M)") %>
      </div>
    </td>
    <td>
      <% if submission.images.size > 0 %>
        <%= submission.image_count %>
      <% end %>
    </td>      
    <td>
      <% unless submission.can_download?(current_user) %>
        <%= image_tag 'download-icon-off.png',:title => "Access denied.\nPrivacy level: #{submission.privacy_level.name}" %>
      <% else %>
        <%= link_to (image_tag 'download-icon.png'), submission.link, :title => "Download file from submitted link" %>
      <% end %>
    </td>
    <% if can? :update, submission %>
      <td>
        <%= link_to (image_tag 'edit-icon.png'), edit_submission_path(submission), :title => "Edit submission" %>
      </td>
    <% end %>
    <% if can? :destroy, submission %>
      <td>
        <%= link_to((image_tag 'delete-icon.png'), submission,
          :title => "Delete submission", :confirm => 'Are you sure?', :method => :delete) %>
      </td>
    <% end %>
  <% end %>
<% end %>
</table>

<%= link_to 'New Submission', new_submission_path %>
